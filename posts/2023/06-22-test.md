%{
    title: "Testamente Webbansvarig, eller: Hur jag l칛rde mig att sluta oroa mig och 칛lska Elixir",
    author: "Adrian Salamon",
    tags: ~w(hello world),
    description: "Written on a keyboard that i am not comfortable with at all"
}
---

## Ansvarsomr친den

METAspexet har flera hemsidor, som m친ste tas hand om. F칬rtst och fr칛mst 칛r det v친r publika hemsida s[metaspexet.se](https://metaspexet.se), och 칛ven [haj](https://haj.metaspexet.se), d칛r du f칬rhoppningsvis l칛ser detta. Som Webbansvarig ansvarar du f칬r b친de underh친ll och vidareutveckling av dessa sidor. B친da dessa hemsidor 칛r egenutvecklade sidor, som framf칬rallt har skrivits av Adrian Salamon, Webbansvarig 2023-2024. Fr친gor kring hur dessa system fungerar kan med f칬rdel f칬ras till adrian p친 [asalamon@kth.se](mailto:asalamon@kth.se).

### Logistik

K칛llkoden f칬r metaspexet.se och haj ligger b친da p친 [datasektionens GitHub](https://github.com/datasektionen/). Haj ligger publikt, medans metaspexets hemsida (metaspexet2) 칛r ett privat repo. Du b칬r f친 access hit fr친n antingen tidigare webbchef, eller datasektionens systemansvarig (d-Sys). B친da hemsidorna hostas via hostingtj칛nsten [fly.io](https://fly.io) som 칛r separat fr친n datasektionens system. D칛r finns en organisation med namn `metaspexet`. Du ska f친 access hit av tidigare webbansvarig. Fly 칛r generellt v칛ldigt smidigt att jobba med, och har bra [dokumentation](https://fly.io/docs/) f칬r hur man anv칛nder deras cli.

En del av det som hostas ligger 칛ven p친 [Amazon Web Services (AWS)](https://aws.amazon.com/). Specifikt s친 hostas statiskt content, allts친 bilder, filmer och ljudfiler p친 AWS S3. Dessutom anv칛nder vi AWS CloudFront som agerar som en CDN som cachar detta f칬r att snabbare kunna serva till klienter. Spexet har en egen organisation som ligger under Datasektionens konto. Du b칬r f친 tillg친ng hit av tidigare webbansvarig.

B친de metaspexet.se och haj 칛r skrivna i programmeringsspr친ket [Elixir](https://elixir-lang.org/) med webbframeworket [Phoenix](https://www.phoenixframework.org/).  Detta 칛r inte det mest popul칛ra eller kanske vanligaste programmeringsspr친ket att jobba i, men det 칛r inte 칬verdrivet sv친rt att l칛ra sig. Anledningen till att systemen 칛r skrivna i Elixir 칛r flera. F칬rst och fr칛mst gillade Adrian Elixir och funktionell programmering, men det var 칛ven ett pragmatiskt val f칬r att snabbt och effektivt kunna skriva v칛lfungerande och robusta system. [Phoenix LiveView](https://hexdocs.pm/phoenix_live_view/Phoenix.LiveView.html), som 칛r en del av Phoenix, g칬r det m칬jligt att skriva interaktiva hemsidor utan att beh칬va skriva separata frontends och backends, och hela Haj best친r av mindre 칛n 300 rader av JavaScript.

Om du vill vidareutveckla n친got av systemen kan det vara bra att ha grundl칛ggande kunskaper om funktionell programmering och Elixir. Ett bra st칛lle att b칬rja p친 칛r dokumentationen f칬r b친de Elixir och f칬r Phoenix. [H칛r](https://elixir-lang.org/learning.html) finns en l칛nk till bra resurser f칬r att l칛ra sig Elixir. Om du l칛ser kurser d칛r det g친r att g칬ra labbar i olika spr친k kan det vara l칛rorikt att f칬rs칬ka g칬ra n친gra i Elixir (ett bra exempel 칛r inet-labben i progp f칬r datastudenter).

### Bilder

Allt statiskt inneh친ll, inklusive bilder, f칬r b친de metaspexet.se och Haj 칛r hostat p친 AWS S3. H칛r sparas bilderna i full uppl칬sning och originalkvalitet. F칬r att enkelt kunna komprimera och skala om bilderna f칬r en specifik storlek s친 anv칛nder vi [Imgproxy](https://imgproxy.net/), som 칛r mjukvara som enkelt kan skala om bilder. Ist칛llet f칬r att be om en bild direkt fr친n S3, s친 ber vi om en bild fr친n `imgproxy` i en specifik storlek, som i sin tur h칛mtar fr친n S3, skalar om, och sedan skickar vidare till klienten. Vi hostar en instans av imgproxy p친 fly.io som alla andra tj칛nster i spexet. F칬r att snabba upp responstider, och minska stressen p친 bildservern s친 anv칛nder vi AWS CloudFront som cachar redan omskalade bilder. Klienter ber allts친 om bilder fr친n CloudFront, och om det finns cachat skickas det tillbaka, annars ber CloudFront om bilden fr친n `imgproxy`, som i sin tur ber om den fr친n S3. Det 칛r m친nga komponenter, men fungerar v칛ldigt snabbt och bra!

### metaspexet.se

metaspexet.se 칛r en mestadels statisk sida f칬r att visa upp spexet mot omv칛rlden. Den ligger under namnet `metaspexet2` p친 datasektionens GitHub. Som en parantes 칛r `metaspexet` en tidigare version av hemsidan som anv칛ndes f칬r spexet 2021, men jag (webbchef 2023) har inte lyckats f친 den att bygga.

Denna webbplats var en g친ng i tiden del av Haj, men 칛r numera avknoppad. F칬r att g칬ra det enkelt br칬ts bara delarna upp och d칛rf칬r 칛r 칛ven denna sida en Phoenix-hemsida. Det finns ingen riktig anledning att ha s친, d친 hemsidan endast best친r av statiskt content och exempelvis inte har n친gon databas eller komplicerad logik. Detta skulle med f칬rdel kunna skrivas om i n친got annat, som g칬r det enklare att jobba med. Det skulle 칛ven kunna vara f칬rdelaktigt att kunna koppla upp med en CMS f칬r att enklare kunna redigera sidan (nu 칛r det mesta h친rdkodat). Ett exempel 칛r att g칬ra en enkel statisk-site-generator skriven i Elixir, se [detta exempel](https://fly.io/phoenix-files/crafting-your-own-static-site-generator-using-phoenix/) p친 hur enkelt det kan vara.

Bilder hostas som sagt p친 S3 och servas via CloudFront och `imgproxy`, s친 om du vill 칛ndra och l칛gga upp nya bilder s친 l칛gger du f칬rst in de p친 S3, och sedan uppdaterar url-er i applikationen. Just nu 칛r allting hyfsat h친rdkodat, vilket med f칬rdel g칬rs om f칬r att bli enklare att jobba med.

### Haj 游붇

Den stora (30 meter) delen av webb i spexet 칛r utan tvekan Haj. Haj 칛r en plattform som 칛r till f칬r att underl칛tta spexarbetet f칬r b친de chefer och gruppisar.

#### Funktioner

Just nu finns funktioner p친 Haj f칬r att:
* Hitta information om spexmedlemmar
* Se vilka som 칛r med i olika grupper
* Hitta chefer f칬r grupper med kontaktuppgifter
* Best칛lla merch och kl칛der
* Se och lyssna p친 gamla spexl친tar
* Se tidigare ansvarsomr친den och testamenten
* Skriva testamenten och ansvarsbeskrivningar (META)
* S칬ka f칬r att bli medlem i spexet
* Sk칬ta antagning av nya spexmedlemmar
* Administrera allt ovan skrivet (t. ex. l칛gga till spex, grupper, anv칛ndare, l친tar etc.)

M친let 칛r att Haj ska f친 칛nnu fler funktioner och bli mer anv칛ndbart. Stora m친l 칛r:
* Eventsystem - d칛r det ska g친 att anm칛la sig till exempelvis gasquer
* Enk칛ter - g칬ra det enklare att samla in feedback, exempelvis genom att kunna n친 ut till alla som var med p친 en specifik teambuilding eller ett samrep

The sky is the limit med vilka funktioner man vill att Haj ska ha. Det viktiga att t칛nka p친 칛r att det ska vara anv칛ndbart f칬r spexet - prata g칛rna med chefsgruppen f칬r att f친 feedback p친 vad de tycker 칛r viktigt eller skulle underl칛tta deras arbete.

#### Utveckling

Haj 칛r ett hyfsat stort system skrivet i Elixir med Phoenix. Sidan finns [publikt](https://github.com/datasektionen/haj) p친 datasektionens GitHub. Anv칛nd med f칬rdel GitHub och jobba med pull requests f칬r att g칬ra det enklare att se n칛r och hur koden har 칛ndrats, samt att enkelt kunna g친 tillbaka om n친got g친r 친t pipsv칛ngen.

Det finns mycket kod i projektet och det kan eventuellt vara sv친rt att hitta r칛tt. Strukturen och organisationen av kod f칬ljer i princip till fullo hur de flesta Phoenix-applikationer ser ut, och b칬r d칛rf칬r vara enkelt att f칬lja om man l칛ser dokumentation eller guider f칬r Phoenix. I princip hela sidan 칛r skriven med hj칛lp av Phoenix LiveView, och alla filer som r칬r detta ligger i `lib/haj_web/live`. All kod som r칬r business-logik, allts친 kommunikation med databasen ligger i `lib/haj`. I GitHub-repot finns instruktioner om hur man kompilerar och bygger applikationen, och det finns 칛ven beskrivning hur man g칬r detta smidigt med Docker.

F칬r att k칬ra applikationen kr칛vs vissa hemliga environment-variabler, som finns beskrivna i `config/.env.example`. Dessa b칬r du f친 tillg친ng till fr친n tidigare webbansvarig. Feel free att l칛gga till saker h칛r som 칛r otydliga, saker du st칬ter p친 eller som kan vara sv친rt i b칬rjan.

N친gra saker som jag tycker 칛r extra viktigt att f친 med h칛r: t칛nk en g친ng extra kring s칛kerheten i systemet.

##### S칛kerhet

Vi lagrar information som potentiellt sett kan vara k칛nslig, exempelvis matpreferenser och allergier. Dessutom sparar vi personers adresser, telefonnummer och personnummer. Detta m친ste g칬ras korrekt enligt GDPR, och det skulle vara v칛ldigt jobbigt att ha ett s칛kerhetsh친l.

Personer som vill logga in p친 Haj m친ste f칬rst autentisera via kths login-system, som vi g칬r via datasektionens system vid namn `login` ([login.datasektionen.se](https://login.datasektionen.se)). Om man inte 칛r eller har varit medlem i spexet b칬r main inte f친 tillg친ng till Haj. Ett enkelt s칛tt att testa detta 칛r att g친 in p친 `inst칛llningar > anv칛ndare` och sedan klicka p친 `Hijack` f칬r en anv칛ndare, d친 loggar du in som anv칛ndaren och ser hur systemet ser ut f칬r den personen. F칬r att se till att r칛tt personer har tillg친ng till r칛tt saker anv칛nder vi ett (fantastiskt bra) authorization-bibliotek som heter [let_me](https://github.com/woylie/let_me). Helt enkelt definierar vi alla v친ra authorization-regler i en fil som heter `lib/haj/policy/policy.ex`, och alla checkar i `lib/haj/policy/checks.ex`. D친 LiveView fungerar genom att f칬rst g칬ra en vanlig HTTP-request, och sedan navigera sidan och skicka data via websockets, m친ste man t칛nka p친 att inte bara g칬ra auktorisering vid f칬rsta request, utan 칛ven p친 varje LiveView-sida. F칬r mer information om detta b칬r man med f칬rdel l칛sa [LiveView Security Considerations](https://hexdocs.pm/phoenix_live_view/security-model.html). Ett exempel p친 hur detta implementeras 칛r att i en sida f칬r att lista ansvarsomr친den ha f칬ljande kod:

```elixir
on_mount {HajWeb.UserAuth, {:authorize, :responsibility_read}}
```

### Rekrytering

Som webbansvarig 칛r det nice att ha en grupp s친 man slipper g칬ra allt sj칛lv, samt att ha n친gra andra man kan bolla id칠er och ha kul med. Storleken p친 gruppen kan variera, men generellt kan det vara enklare att f친 en bra sammanh친llning och mer engagemang i en mindre grupp. Man beh칬ver inte rekrytera personer som har mycket erfarenhet av webbutveckling, utan det viktigaste 칛r att personerna 칛r taggade p친 att l칛ra sig mer och har en del tid att l칛gga ner.

## Schemal칛ggning/planering

### 칀rsplanering

Ur ett planeringsperspektiv 칛r det inte n친gra supertydliga tidspunkter att f칬rh친lla sig till. F칬r spexets externa hemsida metaspexet.se s친 칛r det viktigt att den fixas innan biljetterna b칬rjar s칛ljas och man b칬rjar marknadsf칬ra spexet. Synka med 칬vriga chefer som h친ller p친 med PR, exempelvis PR-synkchef, Grafiqchef och Fotofilmchef kring n칛r biljetter b칬rjar s칛ljas, gruppbilder finns tillg칛ngliga och n칛r hemsidan ska vara f칛rdig. Generellt b칬r det inte ta mer 칛n en eftermiddag eller tv친 att uppdatera hemsidan till 친rets design, f칬rutsatt att allt material som beskrivningar, bilder, och film redan finns. Det kan vara smart att be om detta fr친n andra chefer i god tid f칬r att minimera stressen f칬r dem.

Om du har en grupp 칛r det v칛ldigt viktigt att ha regelbundna m칬ten. Ett bra uppl칛gg 칛r att ha ett m칬te minst varannan vecka. Om detta inte sker kan det vara l칛tt att gruppisar tappar intresse och att det g친r v칛ldigt tr칬gt fram친t. En f칬rdel med webbgruppen till skillnad fr친n resten av spexet 칛r att det g친r att komma ig친ng med arbetet direkt, och man 칛r s칛llan blockad av att exempelvis manuset ska vara f칛rdigt, det g친r att jobba p친 Haj n칛r som!

Se 칛ven till att ordna teambuildings och utnyttja hela teambuildingbudgeten. Speciellt i b칬rjan av 친ret 칛r det viktigt att se till att gruppen l칛r k칛nna varandra och bli bekv칛ma med varandra.

## Budget

Webbgruppen b칬r ha en budget f칬r interna aktiviteter (m칬ten och teambuildings), som b칬r ligga i linje med resten av spexets budget per medlem. Dessutom m친ste webb ha en budget f칬r hosting av servrar, och den har tidigare 친r legat p친 3000kr under namnet "Mjuk- och h친rdvarukostnader". Enklast 칛r att k칬pa credits, exempelvis 100USD credits p친 fly.io och l칛gga in p친 Cashflow f칬r att f친 pengarna tillbaka av datasektionen. Du b칬r f친 en genomg친ng av ekonomiansvarig/direqtionen om hur cashflow fungerar och hur man g칬r utl칛gg f칬r sektionen om du inte gjort detta innan.

## 칐vrigt

Webbansvarig 칛r ett grymt kul och grymt flexibelt ansvar. Man f친r verkligen g칬ra det man k칛nner f칬r och vill l칛ra sig mer av. Dessutom 칛r det ett v칛ldigt bra s칛tt att bilda sig kunskap om webbutveckling vilket framtida arbetsgivare kommer uppskatta. Det man skriver kommer dessutom f칬rhoppningsvis leva kvar i spexet i framtiden! 游붇

Forts칛tt g칛rna skriva p친 denna beskrivning, det 칛r ett levande dokument, se till att l칛gga till ditt namn i botten. Det kan 칛ven vara nice att l칛gga in en bra "credits"-sida p친 Haj, f칬r att ingen ska gl칬mma det fina arbete man gjort f칬r spexet.

Skrivet av Adrian Salamon (Webbansvarig 2023 & 2024)